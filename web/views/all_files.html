<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <script src="/../js/jquery.js"></script>
    <script type="text/javascript">
      var CLIENT_ID = '336029381416.apps.googleusercontent.com';
      var SCOPES = 'https://www.googleapis.com/auth/drive';

      /**
       * Called when the client library is loaded to start the auth flow.
       */
      function handleClientLoad() {
        window.setTimeout(checkAuth, 1);
      }

      /**
       * Check if the current user has authorized the application.
       */
      function checkAuth() {
        gapi.auth.authorize(
            {'client_id': CLIENT_ID, 'scope': SCOPES, 'immediate': true},
            handleAuthResult);
      }

      /**
       * Called when authorization server replies.
       *
       * @param {Object} authResult Authorization result.
       */
      function handleAuthResult(authResult) {
        var authButton = document.getElementById('authorizeButton');
        authButton.style.display = 'none';
        if (authResult && !authResult.error) {
          // Access token has been successfully retrieved, requests can be sent to the API.
          makeApiCall();
        } else {
          // No access token could be retrieved, show the button to start the authorization flow.
          authButton.style.display = 'block';
          authButton.onclick = function() {
              gapi.auth.authorize({
                'client_id': CLIENT_ID, 'scope': SCOPES, 'immediate': false
              },handleAuthResult);
          };
        }
      }


      /**
       * Makes API call to google
       */
      //waits for the client to load before making the actual call
      function makeApiCall() {
        gapi.client.load('drive', 'v2', getFiles);
      }

      //the actual call
      function getFiles() {
        var request = gapi.client.request({
          'path': '/drive/v2/files',
          'method': 'GET'
        });

        //adds html elements
        request.execute(function(resp) {          
          console.log(resp.items);
          for (i=0; i<resp.items.length; i++) {
            var titulo = resp.items[i].title;
            // var file_id = resp.items[i].id;
            // var fechaUpd = resp.items[i].modifiedDate;
            // var userUpd = resp.items[i].lastModifyingUserName;
            // var userEmbed = resp.items[i].embedLink;
            // var userAltLink = resp.items[i].alternateLink;
            var downloadUrl = resp.items[i].downloadUrl;
            url = downloadUrl.substring(0,downloadUrl.length-8);
            
            $("#content").append('<a class="download" href="'+url+'">' + titulo + '</a><br/>');
          }
          
        });
      }


    </script>
    <script type="text/javascript" src="https://apis.google.com/js/client.js?onload=handleClientLoad"></script>
  </head>
  <body>
    <input type="button" id="authorizeButton" style="display: none" value="Authorize" />
    <div id="content"></div>
  </body>
</html>